<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>μRDF.js Online Demo</title>
    <script src="js/urdf-browser.js"></script>
    <script src="js/ace.js"></script>
    <script src="js/mode-json.js"></script>
    <script src="js/mode-sparql.js"></script>
    <style>
        body {
            margin: 0;
        }

        h1 {
            text-align: center;
        }

        .content {
            max-width: 640px;
            margin-left: auto;
            margin-right: auto;
        }

        .code-input {
            height: 500px;
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>μRDF.js</h1>
    </div>

    <div class="content">
        <div>
            <h2>Load:</h2>
            <div id="data" class="code-input"></div>
            <!-- <textarea id="data" rows="50"></textarea> -->
            <button  onclick="load()">Load</button>
            <div>
                TODO
            </div>
        </div>
    
        <div>
            <h2>Query:</h2>
            <div id="query" class="code-input"></div>
            <!-- <textarea id="query"></textarea> -->
            <button onclick="query()">Query</button>
            <table id="results"></table>
        </div>
    </div>

    <script>
        const dataEditor = ace.edit('data');
        const queryEditor = ace.edit('query');
        const resultsField = document.getElementById('results');

        function load() {
            let data = JSON.parse(dataEditor.getValue());

            urdf.load(data).then(() => {
                // TODO feedback
            });
        }

        function query() {
            let q = queryEditor.getValue();

            urdf.query(q)
            .then(results => {
                // deal with missing values
                let vars = results.reduce((list, res) => {
                    for (let v in res) {
                        if (list.indexOf(v) === -1) list.push(v);
                    }
                    return list;
                }, []);

                let html = '<tr>';
                vars.forEach(v =>  html += '<th>' + v + '</th>');
                html += '</tr>';

                results.forEach(res => {
                    html += '<tr>';
                    vars.forEach(v => html += '<td>' + (res[v] ? res[v].value : '') + '</td>');
                    html += '</tr>';
                });

                resultsField.innerHTML = html;
            })
            .catch(e => console.error(e));
        }

        // ACE boilerplate

        dataEditor.session.setMode('ace/mode/json');
        queryEditor.session.setMode('ace/mode/sparql');
    </script>
</body>

</html>